{% extends 'Navbar/MenuAdmin.html' %}

{% block title %}Admin{% endblock %}

{% block content %}

    <div class="container mx-auto px-4 py-8">
        <div class="bg-white rounded-lg shadow-md p-6">
            <div class="flex justify-between items-center mb-6">
                <h1 class="text-2xl font-bold text-gray-800">Demandes en Attente</h1>
                <div class="flex space-x-2">
                    <input type="date" id="dateFilter" class="border rounded px-3 py-2">
                    <button id="filterButton" class="bg-blue-500 text-white px-4 py-2 rounded">
                        <i data-lucide="filter" class="inline-block mr-2"></i>Filtrer
                    </button>
                </div>
            </div>

            <table id="pendingRequestsTable" class="w-full">
                <thead>
                    <tr class="bg-gray-100 border-b">
                        <th class="p-3 text-left">ID</th>
                        <th class="p-3 text-left">Utilisateur</th>
                        <th class="p-3 text-left">Type de Demande</th>
                        <th class="p-3 text-left">Date de Cr√©ation</th>
                        <th class="p-3 text-left">Temps d'Attente</th>
                        <th class="p-3 text-left">Actions</th>
                    </tr>
                </thead>
                <tbody id="pendingRequestsTableBody">
                    <!-- Pending requests will be dynamically populated here -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // Sample pending request data
        const pendingRequests = [
            {
                id: 'REQ-002',
                user: 'marie.martin@example.com',
                type: 'Rapport Financier',
                createdAt: '2024-03-20'
            },
            {
                id: 'REQ-003',
                user: 'pierre.leclerc@example.com',
                type: 'Analyse Marketing',
                createdAt: '2024-03-18'
            },
            // Add more pending requests
        ];

        function calculateWaitingTime(createdAt) {
            const createdDate = new Date(createdAt);
            const today = new Date();
            const waitingDays = Math.floor((today - createdDate) / (1000 * 60 * 60 * 24));
            return `${waitingDays} jours`;
        }

        function renderPendingRequests(filteredRequests = pendingRequests) {
            const tableBody = document.getElementById('pendingRequestsTableBody');
            tableBody.innerHTML = '';

            filteredRequests.forEach(request => {
                const row = document.createElement('tr');
                row.classList.add('border-b');
                row.innerHTML = `
                    <td class="p-3">${request.id}</td>
                    <td class="p-3">${request.user}</td>
                    <td class="p-3">${request.type}</td>
                    <td class="p-3">${request.createdAt}</td>
                    <td class="p-3 text-yellow-600">${calculateWaitingTime(request.createdAt)}</td>
                    <td class="p-3">
                        <div class="flex space-x-2">
                            <button class="text-blue-500" title="Traiter">
                                <i data-lucide="play"></i>
                            </button>
                            <button class="text-red-500" title="Annuler">
                                <i data-lucide="x-circle"></i>
                            </button>
                        </div>
                    </td>
                `;
                tableBody.appendChild(row);
            });

            // Reinitialize Lucide icons
            lucide.createIcons();
        }

        // Filter functionality
        document.getElementById('filterButton').addEventListener('click', () => {
            const dateFilter = document.getElementById('dateFilter').value;
            const filteredRequests = dateFilter 
                ? pendingRequests.filter(req => req.createdAt === dateFilter) 
                : pendingRequests;
            renderPendingRequests(filteredRequests);
        });

        // Initial render
        renderPendingRequests();
    </script>

{% endblock %}